<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆè¯Šæ–­å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        .game-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .game-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .test-result {
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-result.pass {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        .test-result.fail {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .test-result.info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }
        .test-result.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .icon {
            font-size: 24px;
        }
        .message {
            flex: 1;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        .file-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .file-item {
            padding: 8px;
            margin: 4px 0;
            background: white;
            border-radius: 4px;
            font-family: monospace;
        }
        .console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .console-line {
            margin: 2px 0;
        }
        .console-error { color: #f48771; }
        .console-warn { color: #cca700; }
        .console-info { color: #4ec9b0; }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-running { background: #28a745; color: white; }
        .status-stopped { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® æ¸¸æˆè¯Šæ–­å·¥å…·</h1>

        <!-- Tetris Section -->
        <div class="game-section">
            <h2>ğŸ§© ä¿„ç½—æ–¯æ–¹å— (Tetris)</h2>
            <div id="tetris-results"></div>
            <div class="button-group">
                <button class="btn btn-success" onclick="testTetris()">è¿è¡Œæµ‹è¯•</button>
                <button class="btn btn-primary" onclick="openTetris()">æ‰“å¼€æ¸¸æˆ</button>
            </div>
            <div class="console-output" id="tetris-console" style="display:none;"></div>
        </div>

        <!-- Draw & Guess Section -->
        <div class="game-section">
            <h2>ğŸ¨ ä½ ç”»æˆ‘çŒœ (Draw & Guess) <span id="server-status" class="status-badge status-stopped">æœåŠ¡å™¨çŠ¶æ€</span></h2>
            <div id="draw-results"></div>
            <div class="button-group">
                <button class="btn btn-success" onclick="testDrawAndGuess()">è¿è¡Œæµ‹è¯•</button>
                <button class="btn btn-primary" onclick="openDrawAndGuess()">æ‰“å¼€æ¸¸æˆ</button>
                <button class="btn btn-warning" onclick="checkServer()">æ£€æŸ¥æœåŠ¡å™¨</button>
            </div>
            <div class="console-output" id="draw-console" style="display:none;"></div>
        </div>

        <!-- Quick Start Guide -->
        <div class="game-section">
            <h2>ğŸ“– å¿«é€Ÿå¼€å§‹æŒ‡å—</h2>
            <div class="test-result info">
                <span class="icon">ğŸ’¡</span>
                <div class="message">
                    <strong>ä¿„ç½—æ–¯æ–¹å—:</strong> å•æœºæ¸¸æˆï¼Œç›´æ¥æ‰“å¼€å³å¯ç©<br>
                    <strong>ä½ ç”»æˆ‘çŒœ:</strong> éœ€è¦æœåŠ¡å™¨ï¼Œç¡®ä¿æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3001
                </div>
            </div>
        </div>
    </div>

    <script>
        // Override console.log to capture output
        const originalConsole = { ...console };
        const consoles = {
            tetris: [],
            draw: []
        };

        function captureConsole(type) {
            ['log', 'error', 'warn', 'info'].forEach(method => {
                console[method] = function(...args) {
                    originalConsole[method](...args);
                    consoles[type].push({
                        method,
                        message: args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' ')
                    });
                };
            });
        }

        function restoreConsole() {
            Object.keys(originalConsole).forEach(method => {
                console[method] = originalConsole[method];
            });
        }

        function displayConsole(type, elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            container.style.display = 'block';

            if (consoles[type].length === 0) {
                container.innerHTML = '<div class="console-line console-info">æ²¡æœ‰æ§åˆ¶å°è¾“å‡º</div>';
                return;
            }

            consoles[type].forEach(log => {
                const line = document.createElement('div');
                line.className = `console-line console-${log.method}`;
                line.textContent = `[${log.method.toUpperCase()}] ${log.message}`;
                container.appendChild(line);
            });
        }

        // Test results helpers
        function addResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;

            const icons = {
                pass: 'âœ…',
                fail: 'âŒ',
                info: 'â„¹ï¸',
                warning: 'âš ï¸'
            };

            div.innerHTML = `
                <span class="icon">${icons[type]}</span>
                <div class="message">${message}</div>
            `;
            container.appendChild(div);
        }

        // Clear results
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
            document.getElementById(containerId.replace('-results', '-console')).style.display = 'none';
        }

        // Tetris Tests
        async function testTetris() {
            clearResults('tetris-results');
            consoles.tetris = [];
            captureConsole('tetris');

            addResult('tetris-results', 'å¼€å§‹æµ‹è¯•ä¿„ç½—æ–¯æ–¹å—...', 'info');

            // Test 1: Check files exist
            addResult('tetris-results', 'æ£€æŸ¥æ¸¸æˆæ–‡ä»¶...', 'info');
            const files = [
                'public/index.html',
                'public/styles.css',
                'public/tetris.js'
            ];

            let allFilesExist = true;
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        addResult('tetris-results', `âœ“ ${file}`, 'pass');
                    } else {
                        addResult('tetris-results', `âœ— ${file} ä¸å­˜åœ¨`, 'fail');
                        allFilesExist = false;
                    }
                } catch (error) {
                    addResult('tetris-results', `âœ— ${file} åŠ è½½å¤±è´¥`, 'fail');
                    allFilesExist = false;
                }
            }

            // Test 2: Check Canvas support
            const canvasSupported = !!document.createElement('canvas').getContext;
            if (canvasSupported) {
                addResult('tetris-results', 'æµè§ˆå™¨æ”¯æŒ Canvas', 'pass');
            } else {
                addResult('tetris-results', 'æµè§ˆå™¨ä¸æ”¯æŒ Canvas', 'fail');
            }

            // Test 3: Check localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                addResult('tetris-results', 'localStorage å¯ç”¨', 'pass');
            } catch (error) {
                addResult('tetris-results', 'localStorage ä¸å¯ç”¨ï¼ˆæœ€é«˜åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨ï¼‰', 'warning');
            }

            // Test 4: Load and validate JavaScript
            try {
                const response = await fetch('public/tetris.js');
                const code = await response.text();

                // Check for critical functions
                const criticalFunctions = [
                    'TetrisGame',
                    'gameLoop',
                    'moveLeft',
                    'moveRight',
                    'rotate',
                    'checkCollision',
                    'clearLines'
                ];

                let allFunctionsFound = true;
                criticalFunctions.forEach(func => {
                    if (!code.includes(func)) {
                        addResult('tetris-results', `ç¼ºå°‘å…³é”®å‡½æ•°: ${func}`, 'fail');
                        allFunctionsFound = false;
                    }
                });

                if (allFunctionsFound) {
                    addResult('tetris-results', 'æ¸¸æˆé€»è¾‘å®Œæ•´', 'pass');
                }

                // Check for common issues
                if (code.includes('getElementById')) {
                    addResult('tetris-results', 'DOM å…ƒç´ å¼•ç”¨æ­£å¸¸', 'pass');
                }

                if (code.includes('requestAnimationFrame')) {
                    addResult('tetris-results', 'ä½¿ç”¨ requestAnimationFrameï¼ˆæµç•…åŠ¨ç”»ï¼‰', 'pass');
                }

            } catch (error) {
                addResult('tetris-results', `JavaScript ä»£ç æ£€æŸ¥å¤±è´¥: ${error.message}`, 'fail');
            }

            restoreConsole();
            displayConsole('tetris', 'tetris-console');

            // Summary
            if (allFilesExist && canvasSupported) {
                addResult('tetris-results', 'âœ… ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆåº”è¯¥å¯ä»¥æ­£å¸¸è¿è¡Œï¼ç‚¹å‡»"æ‰“å¼€æ¸¸æˆ"æŒ‰é’®å¼€å§‹ç©ã€‚', 'pass');
            } else {
                addResult('tetris-results', 'âŒ å‘ç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°é”™è¯¯', 'fail');
            }
        }

        // Draw & Guess Tests
        async function testDrawAndGuess() {
            clearResults('draw-results');
            consoles.draw = [];
            captureConsole('draw');

            addResult('draw-results', 'å¼€å§‹æµ‹è¯•ä½ ç”»æˆ‘çŒœ...', 'info');

            // Test 1: Check server connectivity
            addResult('draw-results', 'æ£€æŸ¥æœåŠ¡å™¨è¿æ¥...', 'info');
            try {
                const response = await fetch('http://localhost:3001', {
                    mode: 'no-cors'
                });
                addResult('draw-results', 'æœåŠ¡å™¨åœ¨è¿è¡Œï¼ˆç«¯å£ 3001ï¼‰', 'pass');
                updateServerStatus(true);
            } catch (error) {
                addResult('draw-results', 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ http://localhost:3001', 'fail');
                addResult('draw-results', 'è§£å†³æ–¹æ³•: åœ¨ draw-and-guess ç›®å½•è¿è¡Œ npm start', 'warning');
                updateServerStatus(false);
            }

            // Test 2: Check WebSocket support
            const wsSupported = 'WebSocket' in window;
            if (wsSupported) {
                addResult('draw-results', 'æµè§ˆå™¨æ”¯æŒ WebSocket', 'pass');
            } else {
                addResult('draw-results', 'æµè§ˆå™¨ä¸æ”¯æŒ WebSocket', 'fail');
            }

            // Test 3: Check Canvas
            const canvasSupported = !!document.createElement('canvas').getContext;
            if (canvasSupported) {
                addResult('draw-results', 'æµè§ˆå™¨æ”¯æŒ Canvasï¼ˆç»˜ç”»åŠŸèƒ½ï¼‰', 'pass');
            } else {
                addResult('draw-results', 'æµè§ˆå™¨ä¸æ”¯æŒ Canvas', 'fail');
            }

            restoreConsole();
            displayConsole('draw', 'draw-console');
        }

        async function checkServer() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'æ£€æŸ¥ä¸­...';

            try {
                const response = await fetch('http://localhost:3001', { mode: 'no-cors' });
                addResult('draw-results', 'âœ“ æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ', 'pass');
                updateServerStatus(true);
            } catch (error) {
                addResult('draw-results', 'âœ— æœåŠ¡å™¨æœªè¿è¡Œ', 'fail');
                updateServerStatus(false);
            }

            btn.disabled = false;
            btn.textContent = 'æ£€æŸ¥æœåŠ¡å™¨';
        }

        function updateServerStatus(running) {
            const badge = document.getElementById('server-status');
            if (running) {
                badge.textContent = 'è¿è¡Œä¸­';
                badge.className = 'status-badge status-running';
            } else {
                badge.textContent = 'å·²åœæ­¢';
                badge.className = 'status-badge status-stopped';
            }
        }

        // Open games
        function openTetris() {
            window.open('public/index.html', '_blank');
        }

        function openDrawAndGuess() {
            window.open('http://localhost:3001', '_blank');
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            addResult('tetris-results', 'ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹è¯Šæ–­', 'info');
            addResult('draw-results', 'ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹è¯Šæ–­', 'info');
        });
    </script>
</body>
</html>
