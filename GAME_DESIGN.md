# 俄罗斯方块游戏设计文档

## 1. 游戏概述

### 1.1 游戏名称
- **中文**: 俄罗斯方块
- **英文**: Tetris
- **类型**: 益智消除类游戏

### 1.2 游戏目标
通过移动和旋转下落的彩色方块，填满水平行来消除得分，尽可能长时间地避免方块堆叠到顶部。

### 1.3 目标受众
- 年龄段: 6岁以上
- 游戏经验: 初级到中级
- 游戏时长: 单局 5-20 分钟

## 2. 游戏机制

### 2.1 方块系统

#### 7种标准方块
1. **I形** (青色)
   ```
   ■ ■ ■ ■
   ```
   - 特点: 4格直线
   - 用途: 填补单列空缺，一次消除多行

2. **O形** (黄色)
   ```
   ■ ■
   ■ ■
   ```
   - 特点: 2×2正方形
   - 用途: 填补方形空洞

3. **T形** (紫色)
   ```
     ■
   ■ ■ ■
   ```
   - 特点: T型结构
   - 用途: 灵活填充，适应性强

4. **S形** (绿色)
   ```
     ■ ■
   ■ ■
   ```
   - 特点: S型结构
   - 用途: 填补S形凹陷

5. **Z形** (红色)
   ```
   ■ ■
     ■ ■
   ```
   - 特点: Z型结构
   - 用途: 与S形互补

6. **J形** (蓝色)
   ```
   ■
   ■ ■ ■
   ```
   - 特点: J型结构
   - 用途: 填补L形空缺

7. **L形** (橙色)
   ```
       ■
   ■ ■ ■
   ```
   - 特点: L型结构
   - 用途: 与J形互补

### 2.2 游戏区域
- **尺寸**: 10列 × 20行
- **单位**: 格
- **总格子数**: 200

### 2.3 方块生成规则
- **随机生成**: 每种方块出现概率相等(1/7)
- **预览系统**: 显示下一个方块
- **生成时机**: 当前方块锁定后立即生成

### 2.4 方块移动规则

#### 横向移动
- **左移**: 向左移动1格（如果无障碍）
- **右移**: 向右移动1格（如果无障碍）
- **边界检测**: 不能超出左右边界

#### 旋转规则
- **顺时针旋转**: 90度旋转
- **墙踢系统**: 靠墙时自动调整位置
- **碰撞检测**: 旋转后如果碰撞则取消

#### 下落规则
- **自然下落**: 按等级设定的速度自动下落
- **加速下落**: 玩家可加速下落
- **锁定机制**: 方块无法继续下落时锁定

### 2.5 碰撞检测

#### 检测条件
- 边界碰撞 (超出游戏区域)
- 方块碰撞 (与其他方块重叠)
- 底部碰撞 (到达底部)

#### 检测方法
```javascript
// 伪代码
function checkCollision(x, y, shape) {
    for (each cell in shape) {
        if (cell is filled) {
            if (x + cell.x < 0 || x + cell.x >= COLS) return true;
            if (y + cell.y >= ROWS) return true;
            if (board[y + cell.y][x + cell.x] is filled) return true;
        }
    }
    return false;
}
```

## 3. 行消除系统

### 3.1 消除条件
- 完整的一行全部被方块填充
- 不含空格

### 3.2 消除过程
1. **检测**: 从底部向上扫描每一行
2. **标记**: 标记需要消除的行
3. **移除**: 移除已标记的行
4. **下移**: 上方行向下移动填补空缺
5. **新增**: 顶部新增空行

### 3.3 多行消除
- **同时消除**: 可以一次消除多行
- **顺序**: 从下到上依次处理
- **动画**: 建议添加消除动画效果

## 4. 计分系统

### 4.1 基础分数
| 消除行数 | 分数 | 说明 |
|---------|------|------|
| 1 行 | 100 | 单行消除 |
| 2 行 | 300 | 双行消除 |
| 3 行 | 500 | 三行消除 |
| 4 行 | 800 | Tetris! |

### 4.2 等级加成
```
最终分数 = 基础分数 × 当前等级
```

**示例**:
- 等级1消除4行: 800 × 1 = 800分
- 等级5消除4行: 800 × 5 = 4000分

### 4.3 特殊奖励
- **Tetris奖励**: 消除4行额外+1000分
- **连击奖励**: 连续消除有额外加分
- **完美消除**: 全消额外奖励

## 5. 等级系统

### 5.1 升级条件
```
每消除10行升一级
```

### 5.2 速度曲线
| 等级 | 下落时间(秒) | 速度(格/秒) |
|------|-------------|------------|
| 1 | 1.00 | 1.0 |
| 2 | 0.90 | 1.1 |
| 3 | 0.80 | 1.25 |
| 4 | 0.70 | 1.4 |
| 5 | 0.60 | 1.7 |
| 6 | 0.50 | 2.0 |
| 7 | 0.40 | 2.5 |
| 8 | 0.30 | 3.3 |
| 9 | 0.20 | 5.0 |
| 10+ | 0.10 | 10.0 |

### 5.3 等级上限
- **理论上限**: 无限制
- **实际上限**: 约等级20-30（人类极限）

## 6. 游戏结束条件

### 6.1 结束条件
- 新生成的方块无法放置
- 方块生成位置已有障碍物
- 方块锁定后超出游戏区域

### 6.2 游戏统计
- **最终得分**
- **达到等级**
- **消除总行数**
- **游戏时长**
- **最高分记录**

## 7. 用户界面设计

### 7.1 主界面布局
```
┌────────────────────────────────────┐
│         分数: 1200                 │
├────┬──────────────────┬───────────┤
│    │                  │ 下一个     │
│等级│   游戏区域        │           │
│ 3  │   10×20         │  [图示]    │
│    │                  │           │
├────┴──────────────────┴───────────┤
│ 控制说明                            │
└────────────────────────────────────┘
```

### 7.2 界面元素
- **计分板**: 实时显示分数、等级、行数
- **游戏区**: 10×20的游戏区域
- **预览区**: 下一个方块预览
- **控制区**: 操作说明
- **最高分**: 历史最高记录

### 7.3 视觉风格
- **背景**: 渐变紫色背景
- **方块**: 彩色方块带边框
- **网格**: 淡灰色网格线
- **动画**: 流畅的移动和消除动画

## 8. 控制系统

### 8.1 键盘控制
- **← (左箭头)**: 向左移动
- **→ (右箭头)**: 向右移动
- **↑ (上箭头)**: 旋转方块
- **↓ (下箭头)**: 加速下落
- **SPACE**: 暂停/继续
- **P**: 暂停
- **R**: 重新开始

### 8.2 触摸控制
- **虚拟按钮**: 移动端专用
- **手势滑动**: (未来功能)
- **双击**: 快速下落

### 8.3 响应时间
- **输入延迟**: < 50ms
- **渲染帧率**: 60fps
- **按键响应**: 即时响应

## 9. 数据持久化

### 9.1 存储内容
- **最高分**: localStorage
- **游戏设置**: localStorage
- **统计信息**: localStorage

### 9.2 存储格式
```json
{
  "highScore": 15000,
  "gamesPlayed": 100,
  "totalLines": 5000,
  "totalScore": 250000
}
```

## 10. 性能要求

### 10.1 性能指标
- **帧率**: 稳定60fps
- **延迟**: 输入延迟 < 50ms
- **内存**: < 50MB
- **加载**: < 1秒

### 10.2 优化策略
- **Canvas渲染**: 使用Canvas而非DOM
- **requestAnimationFrame**: 确保流畅动画
- **对象池**: 复用方块对象
- **最小化重绘**: 只重绘变化区域

## 11. 未来扩展

### 11.1 游戏模式
- **挑战模式**: 限定方块数量
- **无尽模式**: 无限玩下去
- **对战模式**: 双人竞技
- **限时模式**: 限时挑战高分

### 11.2 新功能
- **道具系统**: 消除行数获得道具
- **成就系统**: 解锁各种成就
- **排行榜**: 全球/好友排行
- **自定义**: 皮肤、主题、音效

### 11.3 社交功能
- **分享**: 分享成绩到社交网络
- **对战**: 实时对战
- **合作**: 双人合作模式

## 12. 技术实现

### 12.1 核心技术栈
- **HTML5**: Canvas API
- **CSS3**: 现代样式和动画
- **JavaScript ES6+**: 游戏逻辑

### 12.2 关键算法
- **碰撞检测**: O(n×m) where n,m是方块尺寸
- **行消除**: O(rows) 一次扫描
- **旋转算法**: 矩阵90度旋转

### 12.3 代码结构
```
TetrisGame (类)
├── init()              # 初始化
├── gameLoop()          # 主循环
├── draw()              # 渲染
├── moveLeft/Right()    # 移动
├── rotate()            # 旋转
├── checkCollision()    # 碰撞检测
├── lockPiece()         # 锁定方块
├── clearLines()        # 消除行
└── addScore()          # 计分
```

---

**文档版本**: 1.0  
**最后更新**: 2026-02-10  
**作者**: AI Game Designer
